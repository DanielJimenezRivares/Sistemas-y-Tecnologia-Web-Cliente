var e={};let t=e=>{let t=document.getElementById(e);if(!t)throw Error(`Template no encontrado: #${e}`);return t.content.cloneNode(!0)},s=e=>null==e?"":String(e);class o extends HTMLElement{static get observedAttributes(){return["title"]}constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(t("tpl-app-header"))}connectedCallback(){this._render()}attributeChangedCallback(){this._render()}_render(){this.shadowRoot.querySelector("h1").textContent=this.getAttribute("title")||"Espacios Culturales"}}customElements.define("app-header",o);class i extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(t("tpl-app-footer"))}connectedCallback(){let e=this.shadowRoot.querySelector(".y");e&&(e.textContent=String(new Date().getFullYear()))}}customElements.define("app-footer",i);class a extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(t("tpl-app-layout"))}}customElements.define("app-layout",a);class r extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(t("tpl-search-espacios")),this.apiBase=window.API_BASE||"",this._all=[]}connectedCallback(){this.shadowRoot.addEventListener("search-espacios-event",e=>this._onSearch(e.detail)),this._list=this.shadowRoot.querySelector("espacios-list"),this._info=this.shadowRoot.getElementById("info")}async _onSearch({q:e,tipo:t}){try{let s=new URLSearchParams;t&&s.set("tipo",t),e&&s.set("q",e),s.set("start",0),s.set("end",4);let o=`${this.apiBase}/espacios${s.toString()?`?${s.toString()}`:""}`,i=await fetch(o);if(!i.ok)throw Error("network");let a=await i.json();this._all=Array.isArray(a.data)?a.data:[],this._render()}catch(e){console.error(e),this._info.textContent="Error al obtener datos.",this._list.setItems([])}}_render(){this._list.setItems(this._all),this._info.textContent=`Mostrando ${this._all.length} resultados`}}customElements.define("search-espacios",r);class n extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(t("tpl-search-form"))}connectedCallback(){let e=this.shadowRoot.querySelector("form");e.addEventListener("submit",t=>{t.preventDefault();let s=new FormData(e),o=(s.get("q")||"").toString().trim(),i=(s.get("tipo")||"").toString();this.dispatchEvent(new CustomEvent("search-espacios-event",{detail:{q:o,tipo:i},bubbles:!0,composed:!0}))})}}customElements.define("search-form",n);class d extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(t("tpl-espacios-list")),this.items=[]}setItems(e){this.items=e||[],this._render()}appendItems(e){this.items=[...this.items,...e||[]],this._render()}_render(){let e=this.shadowRoot.getElementById("list");e.innerHTML="",(this.items||[]).forEach(t=>{let s=document.createElement("li"),o=document.createElement("espacio-card");o.data=t,s.appendChild(o),e.appendChild(s)})}}customElements.define("espacios-list",d);class h extends HTMLElement{constructor(){super(),this._data=null,this._reviewsOpen=!1,this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(t("tpl-espacio-card"))}connectedCallback(){this._btnReviews=this.shadowRoot.querySelector("#btn-reviews"),this._btnReviews&&this._btnReviews.addEventListener("click",e=>{this._reviewsOpen=!this._reviewsOpen,this._syncReviewsButton(),this.reviews=this.shadowRoot.querySelector("search-valoraciones"),this.reviews._toggleReviews({id:String(this._data?.id),open:this._reviewsOpen})}),this._data&&this._render()}set data(e){this._data=e||{},this._render()}get data(){return this._data}_normalize(e){return"_U"===e?"-":e||"-"}_render(){let e=this._data||{},t=this._normalize(e.nombre),o=this._normalize(e.direccion),i=this._normalize(e.horario),a=this._normalize(e.telefono),r=this._normalize(e.web);this.shadowRoot.querySelector("#title").textContent=s(t),this.shadowRoot.querySelector("#dir").textContent=s(o);let n=this.shadowRoot.querySelector(".types-wrap");if(n.innerHTML="",Array.isArray(e.tipos)&&e.tipos.length){let t=document.createElement("div");t.className="types",t.textContent=e.tipos.join(", "),n.appendChild(t)}this.shadowRoot.querySelector("#horario").textContent=`Horario: ${s(i)}`,this.shadowRoot.querySelector("#tel").textContent=`Tel: ${s(a)}`;let d=this.shadowRoot.querySelector("#web");if(d.innerHTML="","-"!==r&&"_U"!==r){let e=document.createElement("a");e.className="link",e.target="_blank",e.rel="noopener",e.href=s(r),e.textContent="Visitar web",d.appendChild(e)}else d.textContent="Web: -"}_syncReviewsButton(){this._btnReviews&&this._btnReviews.setAttribute("aria-expanded",this._reviewsOpen?"true":"false"),this._reviewsOpen?this.setAttribute("reviews-open",""):this.removeAttribute("reviews-open")}}customElements.define("espacio-card",h);class l extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(t("tpl-search-valoraciones")),this.apiBase=window.API_BASE||"",this._all=[],this.hidden=!0}connectedCallback(){this._list=this.shadowRoot.querySelector("valoraciones-list"),this._write=this.shadowRoot.querySelector("valoraciones-write"),this.shadowRoot.addEventListener("review-uploaded",e=>{let t=e.detail?.id??null;t&&this._toggleReviews({id:t,open:!0})})}async _toggleReviews({id:e,open:t}){if(this._write._id=e,t)try{if(!e)return void alert("No se ha seleccionado espacio.");let t=new URLSearchParams;t.set("start",0),t.set("end",4);let s=`${this.apiBase}/valoraciones/reviews/${e}?${t.toString()?`?${t.toString()}`:""}`,o=await fetch(s);if(!o.ok)throw Error("network");let i=await o.json();this._all=Array.isArray(i.data)?i.data:[],this.hidden=!1,this._render()}catch(e){console.error(e),this._info.textContent="Error al obtener datos.",this._list.setItems([])}else this._all=null,this.hidden=!0,this._render()}_render(){this._list.setItems(this._all)}}customElements.define("search-valoraciones",l);class c extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(t("tpl-valoraciones-list")),this.items=[]}setItems(e){this.items=e||[],this._render()}appendItems(e){this.items=[...this.items,...e||[]],this._render()}_render(){let e=this.shadowRoot.getElementById("list");e.innerHTML="",(this.items||[]).forEach(t=>{let s=document.createElement("li"),o=document.createElement("valoraciones-card");o.data=t,s.appendChild(o),e.appendChild(s)})}}customElements.define("valoraciones-list",c);class p extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(t("tpl-valoraciones-card")),this._data=null}set data(e){this._data=e||{},this._render()}get data(){return this._data}_fmtDate(e){if(!e)return"";let t=new Date(e);return isNaN(+t)?"":t.toLocaleString(void 0,{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}_stars(e){let t=Math.max(0,Math.min(5,Number(e)||0));return"★".repeat(t)+"☆".repeat(5-t)}_render(){let e=this._data||{},t=e.username??e.user??"Anónimo",s=e.rating??0,o=e.review??e.text??"",i=e.timestamp??e.createdAt??e.date??e.fecha??"";this.shadowRoot.querySelector(".user").textContent=t,this.shadowRoot.querySelector(".stars").textContent=this._stars(s),this.shadowRoot.querySelector(".date").textContent=this._fmtDate(i);let a=this.shadowRoot.querySelector(".text");o&&"-"!==o?(a.textContent=o,a.hidden=!1):(a.textContent="",a.hidden=!0),this.shadowRoot.querySelector(".stars").setAttribute("aria-label",`Puntuaci\xf3n: ${Number(s)||0} de 5`)}}customElements.define("valoraciones-card",p);class m extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(t("tpl-valoraciones-write")),this.apiBase=window.API_BASE||""}set id(e){this._id=e?String(e):null}get id(){return this._id}connectedCallback(){this.shadowRoot.getElementById("form").addEventListener("submit",e=>this.#e(e))}async #e(e){if(e.preventDefault(),!this._id)return void alert("No se ha seleccionado espacio.");let t=e.currentTarget,s=new FormData(t),o=Number(s.get("rating")||0);if(!o)return void alert("El rating es obligatorio.");let i={espacio_cultural_id:this._id,rating:o,username:(s.get("username")||"").toString().trim()||void 0,review:(s.get("review")||"").toString().trim()||void 0};try{let e=`${this.apiBase}/valoraciones`,s=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(console.log(s),!s.ok)throw Error("network");t.reset(),this.dispatchEvent(new CustomEvent("review-uploaded",{detail:{id:this._id},bubbles:!0,composed:!0}))}catch(e){console.error(e),alert("No se pudo enviar la reseña. Inténtalo de nuevo.")}}}customElements.define("valoraciones-write",m);export{e as default};
//# sourceMappingURL=EspaciosCulturales.652b7965.js.map
